import os
import numpy as np
import pickle as pkl
import scipy.sparse as sp
import json
import pandas as pd
from scipy.sparse import csr_matrix
from _collections import defaultdict
def getAdjlist(filepath = "",name=""):
    adjList = defaultdict(set)
    martix = sp.load_npz(filepath)
    mat_martix = martix.dot(martix.T)
    row = mat_martix.nonzero()[0]
    col = mat_martix.nonzero()[1]
    with open("/mnt/datasets/zeyu/HIN_DATA/"+name+".pkl","wb") as file:
        for i in range(len(row)):
            adjList[row[i]].add(col[i])
        pkl.dump(adjList,file)
if __name__ == "__main__":
    base_path = "/mnt/datasets/zeyu/HIN_DATA"
    paths=["pe_export.npz","pe_imports.npz","pe_characteristics.npz","pe_dll_characteristics.npz","pe_sections.npz"]
    names=["adj_pe_export_pe","adj_pe_imports_pe","adj_pe_characteristics_pe","adj_pe_dll_characteristics_pe","adj_pe_sections_pe"]
    for i in range(len(paths)):
        fullpath = os.path.join(base_path,paths[i])
        getAdjlist(fullpath,names[i])
